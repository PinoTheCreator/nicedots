set drawbox
set info size
set icons
set dircounts
set autoquit on
set previewer "kitty +kitten icat"

# commands

cmd paste &{{
    set -- $(cat ~/.local/share/lf/files)
    mode="$1"
    shift
    case "$mode" in
        copy)
            rsync -av --ignore-existing --progress -- "$@" . |
            stdbuf -i0 -o0 -e0 tr '\r' '\n' |
            while IFS= read -r line; do
                lf -remote "send $id echo $line"
            done
            ;;
        move) mv -n -- "$@" .;;
    esac
    rm ~/.local/share/lf/files
    lf -remote "send clear"
}}

cmd trash ${{
    set -f
    gio trash $fx
}}

cmd mkdir %mkdir "$@"
cmd dragon %dragon-drop -a -x "$f"

cmd open ${{
    case $(file --mime-type "$f" -bL) in
        text/*|application/json) $EDITOR "$f";;
        *) xdg-open "$f" &> /dev/null ;;
    esac
}}

cmd unarchive ${{
  case "$f" in
      *.zip) unzip "$f" ;;
      *.tar.gz) tar -xzvf "$f" ;;
      *.tar.bz2) tar -xjvf "$f" ;;
      *.tar) tar -xvf "$f" ;;
      *) echo "Unsupported format" ;;
  esac
}}

cmd mkfile ${{
  printf "File Name: "
  read ans
  $EDITOR $ans
}}

# remove keybinds
map m
map d

# keybinds
map au unarchive

map mb mark-save
map md push :mkdir<space>
map mf :mkfile

map dT :trash
map dd :cut
map dR :dragon
